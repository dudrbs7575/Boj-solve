#include <bits/stdc++.h>

using namespace std;

string solution(string m, vector<string> musicinfos) {
    string answer = "";
    int beforePlayTime=-1;
    
    for(const string &s : musicinfos){
        char a[1600];
        int h1,h2,m1,m2;
        sscanf(s.c_str(), "%d:%d,%d:%d,%s",&h1,&m1,&h2,&m2, a);
        string title="";
        string melody="";
        int idx = string(a).find(",");
        for(int i=0;i<idx;i++){
            title+=string(a)[i];                
        }
        for(int i=idx+1;i<string(a).length();i++){
            melody+=string(a)[i];
        }   
        
        int playTime=60*h2+m2-(60*h1+m1);
        int melody_len=melody.length();
        int shapCnt=0;
        for(int i=0;i<melody_len;i++){
            if(melody[i]=='#')
                shapCnt++;
        }
        melody_len-=shapCnt;
        
        if(playTime<melody_len){
            int gap=melody_len-playTime;
            while(gap--){
                if(melody[melody.length()-1]=='#')
                    gap++;
                melody.erase(melody.end()-1);
            }
        }
        else{
            int cnt=0;
            melody_len+=shapCnt;
            for(int i=0;i<playTime-melody_len;i++){
                melody+=melody[cnt%melody_len];
                if(melody[cnt%melody_len]=='#')
                    i--;
                cnt++;
            }
        }
        int iidx=melody.find(m);
        if(iidx!=-1){
            if(melody[iidx+m.length()]=='#')
                continue;
            if(beforePlayTime<playTime){
                beforePlayTime=playTime;
                answer=title;
            }
        }
    }
    
    return answer;
}